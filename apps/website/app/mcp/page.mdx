# MCP Knowledge Graph Server

The Model Context Protocol (MCP) server is the core component of Dev Atlas that manages your knowledge graph data using SQLite with Drizzle ORM.

## Overview

The MCP server provides:
- **CRUD Operations** for nodes and edges
- **Advanced Search** capabilities
- **Graph Traversal** algorithms
- **SQLite Storage** with optimized queries
- **Type-Safe Operations** with Zod validation

## Architecture

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   VS Code       │    │   MCP Server     │    │   SQLite DB     │
│   Extension     │◄──►│   (TypeScript)   │◄──►│   Knowledge     │
│                 │    │                  │    │   Graph         │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## Features

### Node Management
- Create, read, update, and delete nodes
- Support for custom properties and metadata
- Type validation with Zod schemas

### Edge Management
- Define relationships between nodes
- Weighted connections
- Directional graph support

### Search & Query
- Full-text search across nodes
- Property-based filtering
- Graph traversal queries

### Performance
- Optimized SQLite queries
- Indexed search operations
- Efficient graph algorithms

## API Reference

The server exposes several tools through the MCP protocol:

### Core Node Operations

- `create_node`: Create a new node
- `get_node`: Retrieve a node by ID
- `query_nodes`: Search and filter nodes
- `update_node`: Modify existing nodes
- `delete_node`: Remove nodes
- `bulk_create_nodes`: Create multiple nodes efficiently
- `search_nodes`: Full-text search across nodes

### Core Edge Operations

- `create_edge`: Create connections between nodes
- `get_edge`: Retrieve edge information
- `query_edges`: Find edges by criteria
- `update_edge`: Modify existing edges
- `delete_edge`: Remove edges
- `bulk_create_edges`: Create multiple edges efficiently
- `get_neighbors`: Get connected nodes

### Graph Analysis Operations

- `find_path`: Find shortest path between nodes
- `get_subgraph`: Extract subgraph around nodes
- `get_graph_stats`: Get graph statistics
- `export_graph`: Export graph data
- `detect_patterns`: Identify patterns in the graph

### Code Analysis Operations

- `analyze_file`: Extract code structure from files
- `extract_dependencies`: Map file dependencies
- `map_directory`: Analyze directory structure
- `extract_todos`: Find TODO comments in code
- `monitor_changes`: Track file system changes
- `semantic_analysis`: Semantic code analysis

### Advanced Features

- `create_or_merge_node`: Smart node creation with merging
- `create_or_merge_edge`: Smart edge creation with merging
- `get_contextual_information`: Get contextual node data
- `get_rich_node_context`: Enhanced node context

### Vector Search & AI Operations

- `vector_search_nodes`: Semantic similarity search
- `generate_embeddings`: Generate node embeddings
- `hybrid_similarity_search`: Combined search approaches
- `analyze_vector_similarity`: Vector similarity analysis

## Database Schema

The knowledge graph uses a simple but powerful schema:

```sql
-- Nodes table
CREATE TABLE nodes (
  id TEXT PRIMARY KEY,
  type TEXT NOT NULL,
  label TEXT NOT NULL,
  properties TEXT, -- JSON
  embedding TEXT, -- Vector embedding for semantic search
  embedding_model TEXT, -- Model used for embedding
  created_at INTEGER DEFAULT CURRENT_TIMESTAMP,
  updated_at INTEGER DEFAULT CURRENT_TIMESTAMP
);

-- Edges table  
CREATE TABLE edges (
  id TEXT PRIMARY KEY,
  source_id TEXT NOT NULL,
  target_id TEXT NOT NULL,
  type TEXT NOT NULL,
  properties TEXT, -- JSON
  weight REAL,
  embedding TEXT, -- Vector embedding for relationship semantics
  embedding_model TEXT, -- Model used for embedding
  created_at INTEGER DEFAULT CURRENT_TIMESTAMP,
  updated_at INTEGER DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (source_id) REFERENCES nodes (id),
  FOREIGN KEY (target_id) REFERENCES nodes (id)
);

-- Vector search cache for performance
CREATE TABLE vector_search_cache (
  id TEXT PRIMARY KEY,
  query_hash TEXT NOT NULL UNIQUE,
  query_embedding TEXT NOT NULL,
  results TEXT NOT NULL, -- JSON
  model TEXT NOT NULL,
  created_at INTEGER DEFAULT CURRENT_TIMESTAMP,
  expires_at INTEGER
);
```

## Configuration

The server can be configured through environment variables:

- `DB_PATH`: SQLite database file path
- `PORT`: Server port (default: 3000)
- `LOG_LEVEL`: Logging verbosity

## Development

To contribute to the MCP server:

```bash
cd apps/mcp-knowledge-graph
npm run dev    # Start development server
npm run test   # Run tests
npm run build  # Build for production
```
